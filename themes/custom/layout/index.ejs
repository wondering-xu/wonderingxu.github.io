<% const posts = page.posts && page.posts.length ? page.posts : site.posts; %>
<% const postItems = posts && posts.each ? posts.toArray() : posts; %>
<% if (postItems && postItems.length) { %>
<section class="post-list">
  <% postItems.forEach(function(post){
    const dataCoverMatch = (post.content || '').match(/data-cover="([^"]+)"/i);
    const coverImage = post.cover || (dataCoverMatch && dataCoverMatch[1]) || '/assets/img/bg-post.webp';
    const postDate = post.date ? date(post.date, 'YYYY-MM-DD') : '';
    const excerptSourceRaw = post.excerpt && post.excerpt.length ? post.excerpt : (post.summary || post.description || '');
    const excerptText = strip_html((excerptSourceRaw || '').toString()).trim().slice(0, 140);
  %>
  <article class="post-card">
    <a class="post-card-link" href="<%= url_for(post.path) %>">
      <div class="post-card-cover" style="background-image: linear-gradient(180deg, rgba(17, 24, 39, 0.6), rgba(17, 24, 39, 0.6)), url('<%= url_for(coverImage) %>');">
        <div class="post-card-meta">
          <% if (postDate) { %>
          <time class="post-card-date" datetime="<%= postDate %>"><%= postDate %></time>
          <% } %>
          <h2 class="post-card-title"><%= post.title %></h2>
        </div>
      </div>
    </a>
    <% if (excerptText) { %>
    <p class="post-card-excerpt"><%= excerptText %></p>
    <% } %>
  </article>
  <% }); %>
</section>
<% } else { %>
<section class="post-list empty">
  <p class="empty-tip">No posts have been published yet.</p>
</section>
<% } %>

<% if (page.total && page.total > 1) { %>
<nav class="pagination" role="navigation">
  <% if (page.prev) { %>
  <a class="pagination-link prev" href="<%= url_for(page.prev_link) %>"><span aria-hidden="true">&larr;</span> Newer Posts</a>
  <% } else { %>
  <span class="pagination-link prev disabled"><span aria-hidden="true">&larr;</span> Newer Posts</span>
  <% } %>
  <span class="pagination-index">Page <%= page.current %> / <%= page.total %></span>
  <% if (page.next) { %>
  <a class="pagination-link next" href="<%= url_for(page.next_link) %>">Older Posts <span aria-hidden="true">&rarr;</span></a>
  <% } else { %>
  <span class="pagination-link next disabled">Older Posts <span aria-hidden="true">&rarr;</span></span>
  <% } %>
</nav>
<% } %>
